<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Radio Player</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                display: flex;
                justify-content: center;
                align-items: center;
                min-height: 100vh;
                margin: 0;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            }

            .player-container {
                background: white;
                padding: 2rem;
                border-radius: 1rem;
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
                max-width: 400px;
                width: 90%;
            }

            h1 {
                margin: 0 0 1.5rem 0;
                color: #333;
                text-align: center;
            }

            audio {
                width: 100%;
                margin-bottom: 1rem;
            }

            .info {
                text-align: center;
                color: #666;
                font-size: 0.9rem;
            }

            .title {
                text-align: center;
                color: #333;
                font-size: 1.5rem;
            }

            .subtitle {
                text-align: center;
                color: #333;
                font-size: 0.9rem;
            }

            .status {
                padding: 0.5rem;
                margin-top: 1rem;
                border-radius: 0.5rem;
                background: #f0f0f0;
                font-size: 0.85rem;
                color: #555;
            }

            .loading {
                background: #fff3cd;
                color: #856404;
            }
        </style>
    </head>
    <body>
        <div>
            <h1 class="title">radio paje, oÃ±iÃ±a-me'e</h1>
            <p class="subtitle">...sons dos que se foram...</p>

            <div class="player-container">
                <h1>ðŸŽµ Radio Paje ðŸŽµ</h1>
                <audio id="audioPlayer" controls autoplay></audio>
                <div class="info">
                    <p id="currentTrack">Loading...</p>
                </div>
                <div id="status" class="status">Ready to play</div>
            </div>
            <div>
                <h1>direme produÃ§Ãµes</h3>
                <div>
                    <div>
                        <h3>direme at radio-paje.com.br</h3>
                    </div>
                </div>
            </div>
        </div>

        <script>
            const audio = document.getElementById("audioPlayer");
            const statusDiv = document.getElementById("status");
            const trackInfo = document.getElementById("currentTrack");

            function updateStatus(message, isLoading = false) {
                statusDiv.textContent = message;
                statusDiv.className = "status" + (isLoading ? " loading" : "");
            }

            function extractFilename(url) {
                const match = url.match(/file=([^&]+)/);
                if (match) {
                    return decodeURIComponent(match[1]);
                }
                return "Unknown";
            }

            function loadNextTrack() {
                updateStatus("Loading next track...", true);

                // Add timestamp to prevent caching
                const timestamp = Date.now();
                const streamUrl = `/stream?t=${timestamp}`;

                // Update audio source
                audio.src = streamUrl;
                audio.load();

                // Try to play (might fail due to autoplay policies)
                audio.play().catch((err) => {
                    console.error("Autoplay failed:", err);
                    updateStatus("Click play to continue");
                });
            }

            // When track metadata is loaded
            audio.addEventListener("loadedmetadata", () => {
                const filename = extractFilename(audio.src);
                trackInfo.textContent = `Now playing: ${filename}`;
                updateStatus("Playing...");
            });

            // When track ends, load the next one
            audio.addEventListener("ended", () => {
                updateStatus("Track ended, loading next...", true);
                loadNextTrack();
            });

            // Error handling
            audio.addEventListener("error", (e) => {
                console.error("Audio error:", e);
                updateStatus("Error loading track. Retrying in 3s...");
                setTimeout(loadNextTrack, 3000);
            });

            // When track starts playing
            audio.addEventListener("playing", () => {
                const filename = extractFilename(audio.src);
                trackInfo.textContent = `Now playing: ${filename}`;
                updateStatus("Playing...");
            });

            // Initial load
            loadNextTrack();
        </script>
    </body>
</html>
